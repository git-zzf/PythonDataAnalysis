[TOC]

# 数据的`CSV`文件存取

`CSV`（Comma-Separated Value, 逗号分隔值）

是一种常见的文件格式，用来存储批量数据

把表格储存成`CSV`文件，数据会用逗号分隔开

`CSV`对于存储一维二维数据很好用

在`NumPy`中有两个函数支持`CSV`格式文件的读取和写入



## `savetxt`方法

保存数组到文件：

```python
np.savetxt(fname, array, fmt='%.18e', delimiter=None)
```

+ `fname`：文件、字符串或产生器，可以是`.gz`或`.bz2`的压缩文件
+ `array`：存入文件的数组
+ `fmt`：写入文件的格式，例如：`%d`、`%.2f`、`%.18e`（默认为`%.18e`格式，即使用科学计数法保留18位小数的浮点数形式存储）
+ `delimiter`：表示分割字符串，默认是空格`None`，由于`CSV`格式要求分隔符是逗号，所以这个参数应该设置成逗号

`.savetxt()`方法不是专门用于保存`CSV`文件的方法，不过通常用于保存`CSV`

例子：

```python
>>> a = np.arange(100).reshape(5,20)
>>> np.savetxt('E:/a.csv', a, fmt=`%d`, delimiter=',')	# 整数
>>> np.savetxt('E:/a.csv', a, fmt=`%.1f`, delimiter=',') # 浮点数
```



## `loadtxt`方法

读取文件到数组类型中：

```python
numpy.loadtxt(fname, dtype=, comments='#', delimiter=None, converters=None, skiprows=0, usecols=None, unpack=False, ndmin=0)
```

+ `fname`：文件、字符串或产生器，可以是`.gz`或`.bz2`的压缩文件（当处理大规模数据的时候，使用压缩文件可以节省空间）
+ `skiprows`：跳过前几行，设置为1就是跳过前1行
+ `comments`：设置为`'#'`指的是如果行的开头为#就会跳过该行
+ `dtype`：数据类型，可选（默认浮点数类型）
+ `usecols`：取出特定列
+ `delimiter`：分割字符串，默认是空格
+ `converters`：预处理
+ `unpack`：如果是`False`就会将读入的数据写入一个数组，如果是`True`就会读入属性分别写入不同数组变量（向量）

例子：

```python
>>> b = np.loadtxt('a.csv', delimiter=',')
```



## 局限性

`CSV`文件只能有效存储一维和二维数组

`savetxt`和`loadtxt`方法也只能有效存取一维和二维数组



****

# 多维数据的存取

## 写入数据`tofile()`

对于`ndarray`中的数组，可以使用一个方法`tofile()`

```python
a.tofile(fname, sep='', format='%s')
```

+ `fname`：文件、字符串
+ `sep`：数据分割字符串，如果不指定，默认是空串，写入文件为二进制
+ `format`：写入数据的格式

例子：

```python
>>> a = np.arange(100).reshape(5, 10, 2)
>>> a.tofile("E:/b.dat", sep=",", format='%d')
0,1,2, ..., 99
```

并不包含任何维度信息，只是用逗号分割每个元素

```python
>>> a = np.arange(100).reshape(5, 10, 2)
>>> a.tofile("E:/b.dat", format='%d')
```

```
                            	   
         
                                                             !   "   #   $   %   &   '   (   )   *   +   ,   -   .   /   0   1   2   3   4   5   6   7   8   9   :   ;   <   =   >   ?   @   A   B   C   D   E   F   G   H   I   J   K   L   M   N   O   P   Q   R   S   T   U   V   W   X   Y   Z   [   \   ]   ^   _   `   a   b   c   
```

不指定格式，生成的是乱码，二进制文件比文本文件占用更小的空间

由于人无法看到其中的内容，所以只能作为数据备份的一种方式



## 读取数据`fromfile()`

```python
np.fromfile(fname, dtypep=float, count=-1, sep='')
```

+ `fname`：文件、字符串
+ `dtype`：读取的数据类型
+ `count`：读入元素的个数，-1表示读入整个文件
+ `sep`：数据分割的字符串，如果是空串，写入文件为二进制，以二进制方式来读入

### 文本文件读取

```python
>>> a = np.arange(100).reshape(5, 10, 2)
>>> a.tofile("E:/b.dat", sep="," format='%d') # sep=","说明是文本文件写入
>>> c = np.fromfile("E:/b.dat", dtype=np.int, sep=",")
>>> c
array([ 0,  1, ..., 99])

>>> c = np.fromfile("E:/b.dat", dtype=np.int, sep=",").reshape(5, 10, 2)
>>> c
array([[[ 0,  1],
        [ 2,  3],
        [ 4,  5],
        ..., 
        [92, 93],
        [94, 95],
        [96, 97],
        [98, 99]]])
```



### 二进制文件读取

```python
>>> a = np.arange(100).reshape(5, 10, 2)
>>> a.tofile("E:/b.dat", format='%d') # 没有定义sep，二进制方式写入
>>> c = np.fromfile("E:/b.dat", dtype=np.int).reshape(5, 10, 2)
>>> c
array([[[ 0,  1],
        [ 2,  3],
        [ 4,  5],
        ..., 
        [92, 93],
        [94, 95],
        [96, 97],
        [98, 99]]])
```



### 需要注意

以这种方法将数组写入文件之后，其中的维度信息丢失，我们必须要在读入的时候知道维度信息才能有效地还原出原数组信息

也就是说在存取文件的时候，`a.tofile()`方法和`np.fromfile()`需要配合使用

在存储文件的时候就需要知道文件的格式和维度，通常的做法是再用一个元数据文件来存储额外信息，在读取文件的时候，打开原信息文件，再读取文件，就可以还原会原来的数组

在面对大规模数据存储的时候，这种方法很有效



## `NumPy`提供的便捷文件存取

使用`np.save(fname, array)`或`np.savez(fname, array)`函数

+ `fname`：文件名，以`.npy`为扩展名，压缩扩展名为`.npz`
+ `array`：数组变量

这种方法的存取只能使用`NumPy`自定义的文件格式

`np.savez(fname, array)`可以以压缩的方法把数组存到文件中，占用空间更小

读取的时候使用`np.load(fname)`函数

+ `fname`：文件名，以`.npy`为扩展名，压缩扩展名为`.npz`

### 例子：

```python
>>> a = np.arange(100).reshape(5, 10, 2)
>>> np.save("E:/Notes/PythonDataAnalysis/01 第一周 数据分析之表示/a.npy", a)
>>> b = np.load("E:/Notes/PythonDataAnalysis/01 第一周 数据分析之表示/a.npy")
>>> b
array([[[ 0,  1],
        [ 2,  3],
        [ 4,  5],
        ...,
        [94, 95],
        [96, 97],
        [98, 99]]])
```

以记事本打开这个`.npy`文件可以看到这个文件是以二进制的形式存储的：

```
揘UMPY v {'descr': '<i4', 'fortran_order': False, 'shape': (5, 10, 2), }                                                      
                            	   
         
```

而在文件的最开始把数组的元信息包括维度，数据类型写到了第一行中，这样在使用`np.laod()`函数读取这个文件的时候，可以通过解析第一行的元信息知道这个文件是一个什么类型什么维度的数据，这样就可以很优秀地还原一个数组



### 用途

如果在程序中间需要进行数据缓存，使用`np.save()`和`np,load()`函数是一个很有效和快捷的方法。如果希望程序能与其它程序做交互和对接，那么需要使用`CSV`文件或者使用`tofile()`方法生成一个其它程序可以识别的文件，使用什么样的文件需要根据不同的使用场景来判断



****

# `NumPy`的随机数函数

`Python`自带的标准库`random`是为一般的标量参数提供随机数生成功能的

在`NumPy`库中，`random`库能为数组类型提供随机数的相关功能

## 常用的随机数组函数：

`np.random.*`星号表示具体的函数名字

| 函数                                                        | 说明                                                 |
| ----------------------------------------------------------- | ---------------------------------------------------- |
| `rand(d0,d1,...,dn)`                                        | 根据`d0`-`dn`创建随机数数组，0到1的浮点数，均匀分布  |
| `randn(d0,d1,...,dn)`                                       | 根据`d0`-`dn`创建随机数数组，标准正态分布            |
| `randint(low[,high,shape])`<br>方括号表示方括号的内容可省略 | 根据`shape`创建随机整数或整数数组，范围是[low, high) |
| `seed(s)`                                                   | 随机数种子，s是给定的种子值                          |

### 示例：

```python
>>> import numpy as np
>>> a = np.random.rand(3, 4, 5)
>>> a
array([[[0.74360263, 0.64772181, 0.39580212, 0.92761766, 0.04735592],
        [0.52884794, 0.04861263, 0.49800601, 0.44435216, 0.36912032],
        [0.8929903 , 0.67237546, 0.07359185, 0.06950671, 0.49292809],
        [0.61768079, 0.92045774, 0.56452298, 0.39395865, 0.84694592]],

       [[0.96705821, 0.01955469, 0.64373697, 0.13838527, 0.93315424],
        [0.18926724, 0.15961274, 0.71576928, 0.7080278 , 0.43291784],
        [0.66268341, 0.99596822, 0.79050691, 0.88711782, 0.6744195 ],
        [0.76569497, 0.18221436, 0.62878455, 0.24680423, 0.70260002]],

       [[0.18501766, 0.12178771, 0.41785991, 0.2605216 , 0.24919911],
        [0.4045764 , 0.64074494, 0.5923519 , 0.66352004, 0.82195956],
        [0.85941904, 0.37552122, 0.40139148, 0.09630643, 0.20447468],
        [0.66028085, 0.16623644, 0.12182643, 0.45131039, 0.56032451]]])

>>> sn = np.random.randn(3,4,5)
>>> sn
array([[[ 0.44837126, -1.19968774,  1.43056874, -0.74064494,
          0.05707649],
        [-1.80118863, -0.86413767,  0.44665023,  0.13390324,
          0.22113107],
        [-0.8865829 , -0.95845544, -0.89035383, -0.52494786,
         -1.34544977],
        [-1.61666784, -0.7105802 ,  0.11946465, -1.15186774,
         -0.28517879]],

       [[ 0.47890162,  0.02795851,  1.00906379,  0.47554476,
          0.96529664],
        [-0.5623248 ,  1.33536525, -0.9635254 , -1.0757338 ,
          1.25701356],
        [-0.98231939,  0.72466934, -0.54142705, -0.73461708,
          1.88604788],
        [-0.55973003,  0.23404076,  0.73973188, -0.59876513,
          0.49463521]],

       [[-0.70218507,  1.42796743,  1.09007554, -0.11045984,
          0.83857885],
        [-0.00916831,  0.5051169 , -1.28295232, -0.53369399,
         -0.20515457],
        [-0.16624298, -0.93464997,  2.26089952, -2.13898878,
          0.74764675],
        [ 1.36318806, -0.05656606,  1.11452171,  0.6934048 ,
          0.80907272]]])

>>> b = np.random.randint(100, 200, (3,4))
>>> b
array([[124, 156, 168, 110],
       [167, 135, 175, 152],
       [193, 185, 165, 152]])
```

### 使用随机数种子例子：

```python
>>> np.random.seed(10)
>>> np.random.randint(100, 200, (3,4))
array([[109, 115, 164, 128],
       [189, 193, 129, 108],
       [173, 100, 140, 136]])

>>> np.random.seed(10)
>>> np.random.randint(100, 200, (3,4))
array([[109, 115, 164, 128],
       [189, 193, 129, 108],
       [173, 100, 140, 136]])
```

在生成随机数组之前使用`seed()`函数可以生成固定的随机数组，不过如果只使用一次种子函数，不能让之后生成一样的随机数组



## 高级随机数组功能

| 函数                         | 说明                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| `shuffle(a)`                 | 随机对`a`的最外维度进行调换，改变`a`数组                     |
| `permutation(a)`             | 随机对`a`的最外维度进行调换，不改变`a`数组                   |
| `choice(a[,size,replace,p])` | 从一维数组`a`中以概率`p`抽取元素，形成`size`形状新数组，`replace`表示是否可以重用元素，默认为`True` |

### `shuffle()`例子：

```python
>>> import numpy as np
>>> a = np.random.randint(100,200,(3,4))
>>> a
array([[189, 112, 165, 131],
       [157, 136, 127, 118],
       [193, 177, 122, 123]])

>>> np.random.shuffle(a)
>>> a
array([[157, 136, 127, 118],
       [189, 112, 165, 131],	# 调换最外层维度（在这里是行）的顺序
       [193, 177, 122, 123]]) 	# 改变了a数组本身

>>> np.random.shuffle(a)
>>> a
array([[189, 112, 165, 131],
       [193, 177, 122, 123],
       [157, 136, 127, 118]])
```

### `permutation()`例子：

```python
>>> import numpy as np
>>> a = np.random.randint(100,200,(3,4))
>>> a
array([[188, 109, 115, 118],
       [180, 171, 188, 111],
       [117, 146, 107, 175]])

>>> np.random.permutation(a)
array([[117, 146, 107, 175],
       [180, 171, 188, 111],
       [188, 109, 115, 118]]) # 调换最外层维度（在这里是行）的顺序

>>> a
array([[188, 109, 115, 118],
       [180, 171, 188, 111],
       [117, 146, 107, 175]]) # a数组本身没有变化
```

### `choice()`例子：

#### 可以反复选取同一个元素

```python
>>> import numpy as np
>>> b = np.random.randint(100,200,(8,)) 
# 这里也可以写np.random.randint(100,200,8)，去掉括号
>>> b
array([106, 185, 122, 111, 112, 192, 196, 162])

>>> np.random.choice(b, (3,2)) # 在b中选取元素形成一个(3,2)的数组
array([[196, 185],
       [185, 162],
       [112, 106]])
```

注意在这里生成的数组中有两个"185"，而原一维数组`b`中只有一个"185"，证明`choice()`函数默认情况下，取出元素的时候每一次都是等概率的，被选取过的元素依然可能被选取

#### 不可反复选取同一个元素

```python
>>> np.random.choice(b, (3,2), replace=False)
array([[111, 112],
       [192, 122],
       [162, 196]])
```

当把`replace`属性赋值`False`后，就不会重复挑选同一个元素了

#### 设定抽取的概率

```python
>>> np.random.choice(b, (3,2), p=b/np.sum(b))
array([[185, 196],
       [162, 196],
       [192, 185]]) 
```

这里设定的概率是` p=b/np.sum(b)`，也就是说，元素的值越大，被抽到的概率就越高



## 产生各种分布的随机数组

| 函数                     | 说明                                                         |
| ------------------------ | ------------------------------------------------------------ |
| `uniform(low,high,size)` | 产生具有均匀分布的数组，`low`起始值，`high`结束值，`size`形状 |
| `normal(loc,scale,size)` | 产生具有正太分布的数组，`loc`均值，`scale`标准差，`size`形状 |
| `poisson(lam,size)`      | 产生具有泊松分布的数组，`lam`随机事件发生率，`size`形状      |

### 均匀分布例子：

```python
>>> import numpy as np
>>> u = np.random.uniform(0, 10, (3,4))
>>> u
array([[5.17844068, 9.49669991, 6.95973867, 9.04664735],
       [6.4789243 , 3.45302149, 0.65497857, 2.20627863],
       [1.37373246, 7.44295925, 3.46690659, 5.77664255]])
```

### 正态分布例子：

```python
>>> u = np.random.normal(10, 5, (3,4))
>>> u
array([[12.39026039, 12.42630461,  7.6250134 ,  4.17067033],
       [ 6.22185054, 12.94051902,  2.80377441,  7.69389331],
       [16.06337282, 13.52330566,  7.7019384 , 12.67410437]])
```

### 泊松分布例子：

```python
>>> u = np.random.poisson(0.5, 100) # 一
>>> u
array([0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 2, 0, 1,
       0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 2, 0, 0, 1, 1, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 2, 2, 0, 1, 0, 1, 1, 1,
       0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0,
       0, 0, 0, 1, 0, 1, 0, 2, 1, 1, 3, 1])
```

上面的例子表示a事件发生的概率是0.5，那么在100个事件中发生a的事件的次数



****

# `NumPy`的统计函数

统计函数能对数组中的信息进行统计

## 常用统计函数

`np.*`星号是函数名字

| 函数                                  | 说明                                                        |
| ------------------------------------- | ----------------------------------------------------------- |
| `sum(a, axis=None)`                   | 根据给定轴`axis`计算数组`a`相关元素之和，`axis`整数或元组   |
| `mean(a, axis=None)`                  | 根据给定轴`axis`计算数组`a`相关元素的期望，`axis`整数或元组 |
| `average(a, axis=None, weights=None)` | 根据给定轴`axis`计算数组`a`相关元素的加权平均值             |
| `std(a, axis=None)`                   | 根据给定轴`axis`计算数组`a`相关元素的标准差                 |
| `var(a, axis=None)`                   | 根据给定轴`axis`计算数组`a`相关元素的方差                   |

如果不给定轴的参数就是对每一个元素进行计算，如果给定轴的参数，就是对轴上的元素进行计算

### `sum()`例子

```python
>>> import numpy as np
>>> a = np.arange(15).reshape(3, 5)
>>> a
array([[ 0,  1,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, 13, 14]])

>>> np.sum(a)
105
```

### `mean()`例子

#### `mean()`例子（第二维度）

```py
>>> np.mean(a, axis=1)
array([ 2.,  7., 12.])
```

这里的平均值运算针对的是第1轴，即对第二个维度的数据求平均值。这个数组有3个元素（第一维度是3个元素），第二维度有5个元素，对这5个值求平均值，结果是：[2., 7., 12. ]

#### `mean()`例子（第一维度）

```python
>>> np.mean(a, axis=0)
array([5., 6., 7., 8., 9.])
```

把`axis`设成0，即对第一维度做平均值运算，第一维度有3个元素，对这三个元素求平均值，就会生成一个一维的与第二维度相同元素数量的新数组

### `average()`例子

```python
>>> np.average(a, axis=0, weights=[10, 5, 1])
array([2.1875, 3.1875, 4.1875, 5.1875, 6.1875])
```

结果中的第三个元素4.1875的计算：

```
(2*10+7*5+1*12)/(10+5+1) = 4.1875
```

### `std`例子

```python
>>> np.std(a)
4.320493798938574
```

### `var`例子

```python
>>> np.var(a)
18.666666666666668
```



## 其它的统计函数

| 函数                          | 说明                                                         |
| ----------------------------- | ------------------------------------------------------------ |
| `min(a)` `max(a)`             | 计算数组`a`中元素的最小值、最大值                            |
| `argmin(a)` `argmax(a)`       | 计算数组`a`中元素最小值、最大值所在位置<br>（降一维后的下标） |
| `unravel_index(index, shape)` | 根据`shape`将一维下标`index`转换成多维下标                   |
| `ptp(a)`                      | 计算数组`a`中元素最大值与最小值的差（极差）                  |
| `median(a)`                   | 计算数组`a`中元素的中位数（中值）                            |

### `max`例子

```python
>>> import numpy as np
>>> b = np.arange(15,0,-1).reshape(3, 5)
>>> b
array([[15, 14, 13, 12, 11],
       [10,  9,  8,  7,  6],
       [ 5,  4,  3,  2,  1]])

>>> np.max(b)
15
```

### `argmax`例子

```py
>>> np.argmax(b)
0
```

在这个例子中，`b`数组是一个3x5维度的数组，最大值的下标应该是：(0, 0)，但是在通过`np.argmax()`函数返回的下标只有一个值0

这意味着它返回的是经过降维后的下标，即当把3x5维度的数组拉成一维数组之后的下标

### `unravel_index`例子

```python
>>> np.unravel_index(np.argmax(b), b.shape)
(0, 0)
```

把扁平化后的下标还原成多维下标

因此，`argmax()`和`argmin()`函数通常与`unravel_index()`函数一起使用

### `ptp`例子

```python
>>> np.ptp(b)
14
```

### `meadian`例子

```python
>>> np.median(b)
8.0
```

求中位数的函数实际上是一种运算，因此尽管原数组中的元素可能都是整数，`np.median()`函数返回的结果是浮点数



****

# `NumPy`的梯度函数

## gradient函数

| 函数             | 说明                                                         |
| ---------------- | ------------------------------------------------------------ |
| `np.gradient(f)` | 计算数组`f`中元素的梯度，当`f`为多维时，它可以计算在每一个维度上，每一个元素对应的梯度值 |

梯度：连续值之间的变化率，即斜率

在XY坐标系连续三个X坐标对应的Y轴值：a, b, c，其中b的梯度是：(c-a)/2

### 一维数组梯度例子

```python
>>> import numpy as np
>>> a =np.random.randint(0, 20, (5))
>>> a
array([ 2,  8, 11, 19, 19])

>>> np.gradient(a)
array([6. , 4.5, 5.5, 4. , 0. ])
```

结果中元素"4.5"的计算过程：

梯度数组的元素4.5对应数组`a`中的元素8

```
(11-2)/2 = 4.5
```

在计算数组最后一个元素的梯度的时候，例如计算`a`数组的最后一个元素19的梯度：

使用最后一个元素减去倒数第二个元素，再除以1

```
(19-19)/1 = 0
```

计算原数组第一个值同理：

使用后一个值减去第一个值，例如在计算数组`a`的第一个元素的梯度时

```
(8-2)/1 = 6
```



### 二维数组梯度例子

```python
>>> import numpy as np
>>> b =np.random.randint(0, 50, (3, 5))
>>> b
array([[34,  2, 26, 17, 14],
       [14, 20, 39, 29, 47],
       [35, 47, 43, 44,  0]])

>>> np.gradient(b)
[array([[-20. ,  18. ,  13. ,  12. ,  33. ],
        [  0.5,  22.5,   8.5,  13.5,  -7. ],
        [ 21. ,  27. ,   4. ,  15. , -47. ]]),
 array([[-32. ,  -4. ,   7.5,  -6. ,  -3. ],
        [  6. ,  12.5,   4.5,   4. ,  18. ],
        [ 12. ,   4. ,  -1.5, -21.5, -44. ]])]
```

由于`b`是二维数组，所以其中任何一个元素的梯度存在两个方向。所以`np.gradient()`返回了两个数组，分别对应两个不同的维度。

第一个数组表明元素在最外层维度的梯度值

第二个数组表明元素在第二层维度的梯度值

例如：

第一个数组的第一个元素-20的计算过程：

同一列中的梯度计算，同一列中下一个元素减去前一个元素（对于第一个元素就减去当前元素）

```
(14-34)/1 = 20
```

第二个数组同理：

同一行中，后一个元素减去前一个元素

```
(2-34)/1 = -32
```

对于有n个维度的数组，它的梯度是n个数组，每个数组代表其中的元素在那个维度的梯度



## 梯度函数的用途

多媒体运算中很重要，梯度表示数据的变化率，在进行图像声音的处理的时候，梯度有助于发现图像和声音的边缘，也就是那些变化比较快的地方。



****

# 单元小结

了解了数据存取的方法

## 存取文件

+ 存取一二维数据的时候，可以使用`CSV`文件，可以使用：
  + `np.loadtxt()`
  + `np.savetxt()`
+ 多维数据的存取，可以使用：
  + `a.tofile()`
  + `np.fromfile()`
  + `np.save()`
  + `np.savez()`
  + `np.load()`



## 随机函数

随机函数：

- `rand(d0,d1,...,dn)`  
- `randn(d0,d1,...,dn)`
- `randint(low[,high,shape])` 
- `seed(s)`
- `shuffle(a)`  
- `permutation(a)` 
- `choice(a[,size,replace,p])`

分布函数：

- `uniform(low,high,size)`  
- `normal(loc,scale,size)`
- `poisson(lam,size)`



## 统计函数

常用统计函数：

- `sum(a, axis=None)` 
- `mean(a, axis=None)`  
- `average(a, axis=None, weights=None)`  
- `std(a, axis=None)`  

其它的统计函数：

- `min(a)` 
- `max(a)`  
- `argmin(a)` 
- `argmax(a)`  
- `unravel_index(index, shape)`  
- `ptp(a)`  
- `median(a)`



## 梯度函数

梯度函数：

+ `np.gradient()`

